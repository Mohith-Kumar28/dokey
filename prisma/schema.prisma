generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Document {
  id         String   @id @default(cuid())
  orgId      String
  ownerId    String
  owner      User     @relation(fields: [ownerId], references: [id])
  title      String
  status     String   @default("draft")
  docJson    Json
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  comments   Comment[]
  redlines   Redline[]
}

model Template {
  id         String   @id @default(cuid())
  orgId      String
  title      String
  description String?
  docJson    Json
  isSystem   Boolean  @default(false)
  createdAt  DateTime @default(now())
}

model ContentBlock {
  id        String   @id @default(cuid())
  orgId     String
  key       String
  name      String
  blockJson Json
}

model Branding {
  id        String   @id @default(cuid())
  orgId     String
  logoUrl   String?
  fontsJson Json?
  colorsJson Json?
}

model Workflow {
  id        String   @id @default(cuid())
  orgId     String
  name      String
  description String?
  steps     WorkflowStep[]
}

model WorkflowStep {
  id           String   @id @default(cuid())
  workflowId   String
  workflow     Workflow  @relation(fields: [workflowId], references: [id])
  stepOrder    Int
  approverRoleKey String
  conditionsJson Json?
}

model Comment {
  id        String   @id @default(cuid())
  docId     String
  document  Document  @relation(fields: [docId], references: [id])
  userId    String
  blockId   String?
  text      String
  createdAt DateTime @default(now())
}

model Redline {
  id        String   @id @default(cuid())
  docId     String
  document  Document  @relation(fields: [docId], references: [id])
  userId    String
  blockId   String
  diffJson  Json
  createdAt DateTime @default(now())
}

model Lock {
  id               String   @id @default(cuid())
  docId            String
  blockId          String
  lockedByRoleKey  String
}

model SigningSession {
  id        String   @id @default(cuid())
  docId     String
  orgId     String
  status    String   @default("pending")
  createdAt DateTime @default(now())
  signers   Signer[]
}

model Signer {
  id          String   @id @default(cuid())
  sessionId   String
  session     SigningSession @relation(fields: [sessionId], references: [id])
  recipientEmail String
  recipientName  String
  order        Int
  status       String   @default("pending")
  authMethod   String?
}

model SignatureEvent {
  id         String   @id @default(cuid())
  sessionId  String
  signerId   String
  type       String
  metaJson   Json?
  createdAt  DateTime @default(now())
}

model AnalyticsEvent {
  id         String   @id @default(cuid())
  docId      String
  sessionId  String?
  type       String
  metaJson   Json?
  createdAt  DateTime @default(now())
}

model User {
  id               String   @id @default(cuid())
  externalProviderId String  @unique
  email            String    @unique
  name             String?
  imageUrl         String?
  createdAt        DateTime  @default(now())
  lastActiveAt     DateTime?
  preferencesJson  Json?
  documents        Document[]
}